:noaudio:
:scrollbar:
:data-uri:
:toc2:
:linkattrs:

= End to End Demo

.Prerequisites
.. Environment setup with all infrastructure components mentioned in lab 01 (setup lab): Kie-Server, Business Central, Red Hat SSO and client applications.
.. Web browser able to login to client applications: hiring-app-internal and hiring-app-public.

:numbered:


== Overview
In this lab we will run the end-to-end cases for candidate selection and interviews in the hiring process, acting as different administrative users and as an applicant to experiment the usage of the platform.

=== Background
One of the departments in our organization wants to hire a new person, so the department raises a hiring petition, which is evaluated for the candidate requisites, interviewer team and compensation; once the job details are defined, the job is automatically posted in the *JOB FINDER* web site, so candidates can start applying for jobs; when a candidate applies the interviewer team can be scheduled and candidate evaluation begins; once a candidate is selected a job offer is generated and the candidate can accept the job offer to complete the case management up to this point.

=== Case Management Diagrams

image::images/all_process.png[Hiring Case Diagram]

== Department request for jobs
Using the back office application (hiring_app_internal)

. Login as `Tina/Password1!` to the back office application (hiring-app-internal). To remember the route required to navigate to the back office application run the following command in the `ssh workstation`:
+
----
oc get route -n client-app | grep internal
----

. From the *Dashboard* web page, select the image:images/blue-plus-button.png[Blue plus button] button.

. Fill the *Add Job* form, they are text fields only, it is preferable that you fill all of them.
+
image:images/add-job-form.png[Add Job Form]

. Submit the form.

=== What did just happen?

image:images/add-jobs-information-flow.png[Information flow diagram]

. Open the source code for the hiring-public-app: https://github.com/barhte2019/hiring-app-internal

+
[NOTE]
====
You have multiple options for this:

. You can navigate the source code in gitHub.

. In our previous lab we had cloned this repository to `$HOME/lab` directory in the `remote ssh workstation`, you can also explore the source code there.

. You can also download the source code from gitHub by cloning it to your local environment or by downloading a zip file from gitHub and decompresing it in your local machine. (Although I will strongly suggest this method, we should mind the current available bandwidth)

Im am using this option and navigating the source code using a local installation of link:https://code.visualstudio.com/download[VSCode], use your favorite method and editor.
====

. The `form submit` event can be found at link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/jobs/add-job/index.tsx[`src/jobs/add-job/index.tsx`] you can notice that the form is using a class method `this.submit` at link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/jobs/add-job/index.tsx#L79[line 79].

+
----
<Form ... onSubmit={this.submit}>
----

. The method `submit` from the `AddJobForm` class at link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/jobs/add-job/index.tsx#L195[line 195], prevents default and sets the shared state for other components to take care of storing the data in the back end.

+
----
private submit = (event: React.FormEvent<HTMLFormElement>) => {
    event.preventDefault();
    this.props.onCreateJob(this.props.jobState.newJob);
}
----

. The `onCreateJob` method is injected by `react-redux connect`, this configuration is done at lines:
.. link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/jobs/add-job/index.tsx#L3[line 3]: import `connect` from `react-redux`
.. link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/jobs/add-job/index.tsx#L20[line 20]: import the `createJob` method definition (we will navigate to this definition later in this section), also observe its injection in link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/jobs/add-job/index.tsx#L50[line 50].

. Find the implementation for the `onCreateJob` method at link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/store/jobs/actions.ts#L147[`src/store/jobs/actions.ts`]

+
----
export function createJob(job: IJob) {
    return dispatch => {
        dispatch({ type: JOB_SUBMIT });
        return api.jobs.create(job).then(resp => {
            dispatch(push('/'));
            return dispatch({ type: JOB_CREATED, jobId: resp.data });
        }).catch(err => {
            return dispatch({ type: JOB_CREATED_ERROR, serverErrors: err })
        });
    }
}
----

. The `createJob` method makes use of the redux `dispatch` that invokes the `reducer` to change the state. For example, the reducer for `JOB_SUBMIT` can be found at link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/store/jobs/reducers.ts#L124[`src/store/jobs/reducers.ts`]

+
----
...
case JOB_SUBMIT: {
   return {
       ...state,
       loading: true
   }
}
...
----

. In order to talk to the back end, the `onCreateJob` method defined in link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/store/jobs/actions.ts#L150[`src/store/jobs/actions.ts`] uses the `api`. [red]#Api is a very relevant asset for the RHPAM configuration#

+
----
return api.jobs.create(job).then(...).catch(...)
----

. The `api` definition can be found at link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/store/api.ts[`src/store/api.ts`]. Observe that every action that is requested to the API is built here. Information about the `Base URL`, formed with the *kie-server* URL and the `Token` for authentication and authorization with *Red Hat SSO* can be found around link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/store/api.ts#L6[line 6], when defining the *Axios instance*. Then after link:https://github.com/barhte2019/hiring-app-internal/blob/master/src/store/api.ts#L36[line 36] we can find interactions and endpoints with the kie-server REST API.

. Find the API configuration for `jobs.create`

. The `hiring petition` reaches the configured *kie-server* and creates a *Case Instance* based in the received information.

== HR define job requirements
By creating a case instance in the previous section, 3 Human Tasks have been initiated that define the job requirement:

* Benefits and compensation
* Define Candidate Skills
* Interviewer team

Confirm the creation of those tasks by using the back office application and navigating to the *Tasks* menu, under the *Group Tasks* tab:

image:images/group-tasks.png[Group Tasks]

The order in which you work in the tasks does not matter, in this section you will work in these 3 tasks and leave the case ready for candidates to apply for jobs.

=== Interviewer team task
. From the *Group Tasks*, locate the *Interviewer Team* task name.

. Using the kebab menu, select the *claim* option.
+
image:images/kebab-interviewer-team.png[Kebab Menu Interviewer Team]

. The previous step will make the *Interviewer Team* task available for the *User Tasks* tab, from the kebab menu of the *Interviewer Team*, select the *modify/complete* option.
+
image:images/kebab-claimed-interviewer-team.png[Kebab Menu Claimed Interviewer Team]

. In the *Define Interviewer Team* emerging screen, type a couple names and a comment stating the skills they should validate.
+
image:images/interviewers-setup.png[Interviewers setup]

. You will notice that the task is completed once you define the interviewer team and click *OK*.

=== Define Candidate skills
. From the *Group Tasks*, locate the *Define Candidate Skills* task name.

. Using the kebab menu, select the *claim* option.
+
image:images/kebab-skills.png[Kebab Menu Candidate Skills]

. The previous step will make the *Interviewer Team* task available for the *User Tasks* tab, from the kebab menu of the *Define Candidate Skills*, select the *modify/complete* option.
+
image:images/kebab-claimed-skills.png[Kebab Menu Claimed Candidate Skills]

. In the *Define Candidate Skills form* emerging screen, type a couple skills with years of experience and knowledge level.
+
image:images/skills-setup.png[Skills setup]
+
[NOTE]
====
There is a duplicate validation for the skill name.
====

. You will notice that the task is completed once you define the candidate skills and click *OK*.

=== Benefits and compensation
. Like in the previous steps, _claim_ and _modify/complete_ the *Benefits and compensation* task.
+
image:images/kebab-claimed-benefits.png[Modify Benefits Task]

. Define a few compensation benefits and select a manager to review the skills before making the job available to applicants. You will login as this manager in the next section and perform the benefits and compensation validation task.
+
image:images/benefits-setup.png[Setup Benefits]

=== Benefits and compensation approval
. Logout from the internal hiring application.

. Login back to the internal hiring application as the user you selected as the Benefits *manager*, (Bob in this example)

. You'll notice that in the *User Tasks* the *Benefits and compensation approval* task is available. Modify/complete the *Benefits and compensation approval task*. By completing this tasks, if the other tasks have been completed (Interviewer team definition and Candidate Skills), then the job will be published for candidates to apply.
+
image:images/benefits-approval.png[Benefits approval available]

== Candidate Apply for jobs

. Log out from the `hiring-internal` application.
+
[NOTE]
====
By having a session open in your browser for the RH-SSO client will prevent other application to log in in the same browser.
As the public hiring application uses the same RH-SSO instance, hence the need to log out first.
====

. Log in into the `hiring-public-application` using `Ava/Password1!` credentials.
. Search for the job title that you just created.
. Hit the *Apply* button, fill and submit the application form.
. Look at your application form status in the *My Applications* menu.

== The interview Process

. Log out from the `public-hiring` application.

. Log in into the `hiring-internal` application using `Eve/Password1!` credentials.

. From the `Applicants` menu review *Ava's* application status.

. From the *Tasks > Group Tasks* section, claim the *Talent Acquisition Documents Review* task.

. *Modify/complete* the *Talent Acquisition Documents Review* task, approving the documentation.

. From the *Task  > Group Tasks* section, claim the *Schedule Interviews*

. *Modify/complete* the *Schedule Interviews* task and enter a comment with time and place information for the interview to take place, like "@phone bridge (555) 555-5555; monday, 3PM".

. Login to the `internal application` as the interviewers, and work in the *Interviewers Feedback* tasks, approving the candidate.
+
[NOTE]
====
You will need to log out and log in multiple times, depending on how many interviewers where defined during the *Interviewer team definition*
====

. Login to the `internal application` as the *Job Request Manager* (see the job details to confirm the user name).

. As the *Job Request Manager*, work in the *Interviewer Feedback Review*, accepting the candidate.

. Login to the `internal application` as `Bob` and work in the **

== Job offer acceptance

. Review the email simulator log at the `kie-server` pod generated by the interview tasks completion.
. Using the `ssh terminal`, login to the `Swift` node and find the document with the job offer.
. Login into the `public application` using `Ava/Password1!` credentials.
. Navigate to *My Applications* menu and *Accept* the job offer.
