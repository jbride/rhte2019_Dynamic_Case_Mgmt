:noaudio:
:scrollbar:
:data-uri:
:toc2:
:linkattrs:

= Lab Setup

.Prerequisites
.. Execute Setup Lab.
.. Web browser installed on your laptop.
.. Broadband internet connectivity.
.. link:https://account.opentlc.com/account/[Red Hat GPTE _Opentlc_ userId]

:numbered:


== Overview
In this lab we will run the end-to-end cases for candidate selection and interviews in the hiring process, acting as different administrative users and as an applicant to experiment the usage of the platform.

=== Background
One of the departments in our organization wants to hire a new person, so the department raises a hiring petition, which is evaluated for the candidate requisites, interviewer team and compensation; once the job details are defined, the job is automatically posted in the *JOB FINDER* web site, so candidates can start applying for jobs; when a candidate applies the interviewer team can be scheduled and candidate evaluation begins; once a candidate is selected a job offer is generated and the candidate can accept the job offer to complete the case management up to this point.

=== Case Management Diagrams

image::images/all_process.png[Hiring Case Diagram]

== Installing client applications
Client applications for this lab are ReactJs websites over a NodeJs server that interact with the kie-server deployed in Openshift during the previous lab.
To install the web sites be sure to have at reach:

* The *RH-SSO KIE-REALM* route.
* The *KIE-SERVER* route.

=== The back office application
The back office application is a web site developed using ReactJs, Redux and Patternfly over NodeJs. This back office web site's source code project is: https://github.com/barhte2019/hiring-app-internal

The back office application allows administrative users like *Talent Acquisition*, *HR* or the *Department interested in hiring* to manage the *Hiring Petitions* and *Candidates*.

=== Create an authentication Client in Red Hat SSO

First we will prepare an authentication and authorization client in *Red Hat SSO* so we can authenticate using the same `realm` that we use to authenticate kie-server and business central RHPAM elements.

. Browse to *Red Hat SSO*, remember, from your `opentlc lab ssh` you can execute the following command to retrieve the *Red Hat SSO route*:

+
----
$ echo -en "\n\nhttps://$rhsso_url/auth/admin/kie-realm/console\n\n"
----

. Use the `admin/admin1234` credentials to authenticate into *Red Hat SSO*.

+
image:images/sso_login_home.png[SSO Login Home]

. Navigate to the *Clients* section, and click the image:images/create-button.png[] button in the top right corner of the Clients list.

+
image:images/sso-clients-list.png[RH SSO initial clients list]

. Set the name of the new client as `kie-remote` and *Save* it.

+
image:images/kie-remote-add.png[Add Kie-remote client]

. From the settings for the `kie-remote` client: [red]#Switch off# the *Standard Flow Enabled* and *Save* the changes.

+
image:images/kie-remote-standard-flow.png[Switch off standard flow]

. From the *Kie-remote* client settings, keep handy the *JSON* format for the *Installation Tab*, specially the *auth-server-url*, we will use it when installing the client applications.

+
image:images/kie-remote-json-installation.png[Kie Remote JSON installation format]

=== The public web site application

== Department request for jobs
Using the back office application (hiring_app_internal),
== HR define job requirements
== Candidate Apply for jobs
== The interview Process
== Job offer acceptance

== OpenStack _Swift_ node for Document Storage

One of the nodes in the environment you have ordered runs an Openstack Swift instance which provides object storage. A container is created in this environment which can store objects. In the lab, offer letters will be stored and retrieved from this storage using a Fuse route. In this section, you will verify that you have access to the Swift object store by running a few curl commands to test it. A cotnainer called TEST and a user called test has been pre-created with a password testing. You will obtain an OAuth token to access the object store API, using the user and password information provided.

. Switch to root user using `sudo -i`
. ssh into the Swift node
+
-----
$ ssh swift.example.com
-----

. Look-up the IP and user information by viewing the /etc/swift/proxy.conf file on the Swift node.
+
-----
$ cat /etc/swift/proxy-server.conf
.....
[DEFAULT]
bind_ip = 192.168.0.20
bind_port = 8080
workers = 8
user = swift


# This is a sample used for functional tests in SAIO. Contains well-known
# passwords.
[filter:tempauth]
use = egg:swift#tempauth
user_admin_admin = ***** .admin .reseller_admin
user_test_tester = testing .admin
user_test2_tester2 = testing2 .admin
user_test_tester3 = testing3
user_test5_tester5 = testing5 service
....
-----

. Issue a swift command to obtain information on the container created for you.
+
-----
$ swift --info --debug  -A http://192.168.0.20:8080/auth/v1.0 -U test:tester -K testing list TEST

DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): 192.168.0.20
DEBUG:urllib3.connectionpool:http://192.168.0.20:8080 "GET /auth/v1.0 HTTP/1.1" 200 0
DEBUG:swiftclient:REQ: curl -i http://192.168.0.20:8080/auth/v1.0 -X GET
DEBUG:swiftclient:RESP STATUS: 200 OK
......
-----

. Use the IP obtained in the swift command or from proxy.conf to issue a GET request to obtain the OAuth token
+
-----
$ curl -v -H 'X-Storage-User: test:tester' -H 'X-Storage-Pass: testing' http://192.168.0.20:8080/auth/v1.0

* About to connect() to 192.168.0.20 port 8080 (#0)
*   Trying 192.168.0.20...
* Connected to 192.168.0.20 (192.168.0.20) port 8080 (#0)
> GET /auth/v1.0 HTTP/1.1
> User-Agent: curl/7.29.0
> Host: 192.168.0.20:8080
> Accept: */*
> X-Storage-User: test:tester
> X-Storage-Pass: testing
>
< HTTP/1.1 200 OK
< X-Storage-Url: http://192.168.0.20:8080/v1/AUTH_test
< X-Auth-Token-Expires: 75389
< X-Auth-Token: AUTH_tkbca12e00c544400abe044fd7e4639c1b
< Content-Type: text/html; charset=UTF-8
< X-Storage-Token: AUTH_tkbca12e00c544400abe044fd7e4639c1b
< Content-Length: 0
< X-Trans-Id: txff48655287f6427cbcec7-005d1b8f94
< X-Openstack-Request-Id: txff48655287f6427cbcec7-005d1b8f94
< Date: Tue, 02 Jul 2019 17:08:36 GMT
<
-----

. Create a simple text file under the /tmp directory and issue curl PUT and GET commands to verify that the document can be saved and retrieved. Use the OAuth token output from the previous command here. The x-object-meta-mtime parameter is optional.
+
-----
$ curl -i http://192.168.0.20:8080/v1/AUTH_test/TEST/tmp/nandantestfile1 -T /tmp/nandantestfile1 -X PUT -H "Content-Length: 13" -H "x-object-meta-mtime: 1562086115.848627" -H "X-Auth-Token: AUTH_tkbca12e00c544400abe044fd7e4639c1b"
HTTP/1.1 100 Continue

HTTP/1.1 201 Created
Last-Modified: Tue, 02 Jul 2019 16:56:54 GMT
Content-Length: 0
Etag: a13413187c04bd0022037c783b1d4be4
Content-Type: text/html; charset=UTF-8
X-Trans-Id: tx84fee81b8f97400da889a-005d1b8cd5
X-Openstack-Request-Id: tx84fee81b8f97400da889a-005d1b8cd5
Date: Tue, 02 Jul 2019 16:56:53 GMT

[root@swift-repl ~]# curl -X GET -H "X-Auth-Token:AUTH_tkbca12e00c544400abe044fd7e4639c1b" -i http://192.168.0.20:8080/v1/AUTH_test/TEST/tmp/nandantestfile1
HTTP/1.1 200 OK
Content-Length: 13
Content-Type: application/octet-stream
Accept-Ranges: bytes
Last-Modified: Tue, 02 Jul 2019 16:56:54 GMT
Etag: a13413187c04bd0022037c783b1d4be4
X-Timestamp: 1562086613.61380
X-Object-Meta-Mtime: 1562086115.848627
X-Trans-Id: tx0054a426a3014ea2bf173-005d1b8cde
X-Openstack-Request-Id: tx0054a426a3014ea2bf173-005d1b8cde
Date: Tue, 02 Jul 2019 16:57:02 GMT

abcracadabra
-----

You have verified that in your environment you can access the Swift object storage and store and retrieve files.
